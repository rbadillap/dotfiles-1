---
- name: Install packages
  become: yes
  pacman:
    name: "{{ item }}"
    state: latest
  with_items:
    - tar
    - lxappearance

- name: Create directory
  file:
    path: "{{ fonts_home }}"
    state: directory

- name: Download fonts
  get_url:
    url: "http://www.roemisch-drei.de/{{ fonts_tar }}"
    dest: "{{ fonts_home }}/{{ fonts_tar }}"

- name: Unarchive fonts
  unarchive:
    src: "{{ fonts_home }}/{{ fonts_tar }}"
    dest: "{{ fonts_home }}"

- name: Symlink fonts
  become: yes
  file:
    src: "{{ item }}"
    dest: /usr/share/fonts/OTF/{{ item | basename }}
    state: link
  with_fileglob:
    - "{{ fonts_home }}/patched-fonts/fonts/SFText/*.otf"
    - "{{ fonts_home }}/patched-fonts/fonts/SFDisplay/*.otf"
    - "{{ fonts_home }}/patched-fonts/fonts/SFMono/*.otf"
    - "{{ fonts_home }}/patched-fonts/patched-fonts/SFText/*.otf"
    - "{{ fonts_home }}/patched-fonts/patched-fonts/SFDisplay/*.otf"
    - "{{ fonts_home }}/patched-fonts/patched-fonts/SFMono/*.otf"

- name: Create font configuration directory
  file:
    path: "{{ fonts_config_home }}"
    state: directory

- name: Symlink font configuration
  file:
    src: "{{ dotfiles_home }}/playbooks/roles/fonts/files/{{ item }}"
    dest: "{{ fonts_config_home }}/{{ item }}"
    state: link
  with_items:
    - fonts.conf

- name: Ensure absence of font configuration
  become: yes
  file:
    path: "/etc/fonts/conf.d/{{ item }}"
    state: absent
  with_items:
    - 10-scale-bitmap-fonts.conf
