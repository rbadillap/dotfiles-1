#!/bin/bash

if [ ! -d "$HOME/svn" ]; then
  echo "Abort: No svn repository found in $HOME/svn."
  exit 0
fi

mkdir -p "$HOME/svn/ftl-symlinks"

while [[ $# -gt 0 ]]; do
  key="$1"

  case $key in
    -c|--clear)
      rm -rf "$HOME/svn/ftl-symlinks/*"
      ;;
    *)
      ;;
  esac

  shift
done

# iterate over all ftl-admin directories
for dir in $(find "$HOME/svn" -path "*/ftl-admin"); do
  # iterate over all *.ftls in ftl-admin recursivly
  for file in $(find "$dir" -path "*.ftl"); do
    # find the subdirs after ftl-admin
    subdir=$(echo $(dirname "$file") | sed 's/.*\(ftl-admin\)/\1/g' | cut -d'/' -f2-)

    # symlink to the right folders
    if [ "$subdir" != "ftl-admin" ]; then
      mkdir -p "$HOME/svn/ftl-symlinks/$subdir"
      ln -sf "$file" "$HOME/svn/ftl-symlinks/$subdir/$(basename "$file")"
    else
      ln -sf "$file" "$HOME/svn/ftl-symlinks/$(basename "$file")"
    fi
  done
done
