#!/bin/bash

if [ ! -d "$HOME/svn" ]; then
  echo "Abort: No svn repository found in $HOME/svn."
  exit 0
fi

mkdir -p "$HOME/svn/ftl-symlinks"

while [[ $# -gt 0 ]]; do
  key="$1"

  case $key in
    -c|--clear)
      rm -rf "$HOME/svn/ftl-symlinks/*"
      ;;
    *)
      ;;
  esac

  shift
done

# iterate over all ftl-admin directories
find "$HOME/svn" -path "*/ftl-admin" | while read -r dir; do
  # iterate over all *.ftls in ftl-admin recursivly
  find "$dir" -path "*.ftl" | while read -r file; do
    # delete everything before the first folder or file after ftl-admin
    subdir=$(dirname $(sed 's/.*\/ftl-admin\///g' <<< "$file"))

    # symlink to the right folders
    if [ "$subdir" != "." ]; then
      mkdir -p "$HOME/svn/ftl-symlinks/$subdir"
      ln -sf "$file" "$HOME/svn/ftl-symlinks/$subdir/$(basename "$file")"
    else
      ln -sf "$file" "$HOME/svn/ftl-symlinks/$(basename "$file")"
    fi
  done
done
